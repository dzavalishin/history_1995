head	1.4;
access;
symbols;
locks;
comment	@ * @;


1.4
date	95.11.05.13.52.48;	author dz;	state Exp;
branches;
next	1.3;

1.3
date	95.04.13.11.06.28;	author dz;	state Exp;
branches;
next	1.2;

1.2
date	95.04.07.10.17.05;	author dz;	state Exp;
branches;
next	1.1;

1.1
date	95.03.11.18.04.17;	author dz;	state Exp;
branches;
next	;


desc
@@


1.4
log
@current.
@
text
@/************************ UU2 Library ***************************\
 *
 *	Copyright (C) 1991,1992 by Infinity Soft
 *
 *	Module 	:	Code table convertor kernel
 *
 *      $Log: Recode.c $
 * Revision 1.3  1995/04/13  11:06:28  dz
 * debug
 *
 * Revision 1.2  1995/04/07  10:17:05  dz
 * Tables moved out
 *
 * Revision 1.1  1995/03/11  18:04:17  dz
 * Initial revision
 *
 *
 *
 *
\*/

#include	<style.h>
#include	<stddef.h>
#include	<string.h>
#include	<strng.h>
#include	"recode.h"


/****************************************************************************
                               Built-in tables
****************************************************************************/


#include     "recode.tbl"






struct ctt									// CodeTable table
	{
	char	*name;							// CodeTable name
	char	*tab;							// Table itself
	};

ctt	ct_tab[] =
	{
		{ "CP866-KOI8",			(char *) cp866_to_koi8	},
		{ "KOI8-CP866",			(char *)koi8_to_cp866	},
		{ "LEO-CP866",			(char *)leo_to_cp866	},
		{ "CP866-CP866",		(char *)cp866_to_cp866	}
	};

#define	CTT_SIZE	(sizeof(ct_tab)/sizeof(ctt))

recoder::
recoder( const char *tabname )
	{

	tab = NULL;

	if( stricmp( tabname, "none" ) == 0 || strlen( tabname ) == 0 )
		{
		alloced = No;
		bad = No;
		return;
		}

	bad = Yes;

	for( int i = 0; i < CTT_SIZE; i++ )
		if( !stricmp( tabname, ct_tab[i].name ) )
			{
			tab = ct_tab[i].tab;
			alloced = No;
			bad = No;
			return;
			}

	// Ok, here we can try to load something from file
	}



recoder::~recoder()
	{
	}

bool
recoder::valid()						// This instnce was constructed
	{
	return (bool)!bad;
	}


uchar
recoder::rc( uchar c )					// Recode character
	{

	if( c < 0x80 || tab == NULL )
		return c;

	return tab[c-0x80];
	}


void
recoder::rs( uchar *s )					// Recode string
	{

	if( tab == NULL )
		return;

	while( *s )
		{
		if( *s < 0x80 )
			{
			s++;
			continue;
			}
	    *s = tab[(*s)-0x80];
		s++;
		}
	}



void
recoder::rs( string &s )      // Recode string
    {
    if( tab == NULL )
        return;

    s.recode_upper_128( tab );
    }







@


1.3
log
@debug
@
text
@d8 3
d25 1
d129 8
@


1.2
log
@Tables moved out
@
text
@d8 3
d30 1
a30 4
#include     "cp866_to_koi8.tab"
#include     "koi8_to_cp866"
#include     "leo_to_cp866"
#include     "cp866_to_cp866"
@


1.1
log
@Initial revision
@
text
@d7 3
a9 13
 *      $Log:   Q:/lib/uu2/vcs/recode.c_v  $
 *      
 *         Rev 1.3   07 Jun 1993 17:51:06   dz
 *      const
 *      
 *         Rev 1.2   16 Oct 1992 03:36:12   dz
 *      New codetable by Leo Broukhis
 *      
 *         Rev 1.1   07 Jul 1992 01:03:32   dz
 *      Russian 'H' replaced with latin 'H' in KOI-CP866 table
 *      
 *         Rev 1.0   04 Feb 1992 22:01:40   dz
 *      Initial revision.
d13 1
d21 5
a25 4
extern uchar		cp866_to_koi8[];
extern uchar		koi8_to_cp866[];
extern uchar		leo_to_cp866[];
extern uchar        cp866_to_cp866[];
d27 4
d36 1
d45 4
a48 4
		{ "CP866-KOI8",			cp866_to_koi8	},
		{ "KOI8-CP866",			koi8_to_cp866	},
		{ "LEO-CP866",			leo_to_cp866	},
		{ "CP866-CP866",		cp866_to_cp866	}
a125 155
/****************************************************************************
							Built-in tables
****************************************************************************/

/*

static uchar
cp866_to_koi8[] =
  {
  0xe1, 0xe2, 0xf7, 0xe7, 0xe4, 0xe5, 0xf6, 0xfa,
  0xe9, 0xea, 0xeb, 0xec, 0xed, 0xee, 0xef, 0xf0,
  0xf2, 0xf3, 0xf4, 0xf5, 0xe6, 0xe8, 0xe3, 0xfe,
  0xfb, 0xfd, 0xff, 0xf9, 0xf8, 0xfc, 0xe0, 0xf1,
  0xc1, 0xc2, 0xd7, 0xc7, 0xc4, 0xc5, 0xd6, 0xda,
  0xc9, 0xca, 0xcb, 0xcc, 0xcd, 0xce, 0xcf, 0xd0,
  0x80, 0x81, 0x82, 0x83, 0x84, 0x85, 0x86, 0x87,
  0x88, 0x89, 0x8a, 0x8b, 0x8c, 0x8d, 0x8e, 0x8f,
  0x90, 0x91, 0x92, 0x93, 0x94, 0x95, 0x96, 0x97,
  0x98, 0x99, 0x9a, 0xbf, 0x9c, 0x9d, 0x9e, 0x9f,
  0xa0, 0xa1, 0xa2, 0xb0, 0xa4, 0xa5, 0xa6, 0xa7,
  0xa8, 0xa9, 0xaa, 0xab, 0xac, 0xad, 0xae, 0xaf,
  0xd2, 0xd3, 0xd4, 0xd5, 0xc6, 0xc8, 0xc3, 0xde,
  0xdb, 0xdd, 0xdf, 0xd9, 0xd8, 0xdc, 0xc0, 0xd1,
  0xb3, 0xa3, 0xb2, 0xb1, 0xb4, 0xb5, 0xb6, 0xb7,
  0xb8, 0xb9, 0xba, 0xbb, 0xbc, 0xbd, 0xbe, 0x9b,
  };


static uchar
koi8_to_cp866[] =
  {
  0xb0, 0xb1, 0xb2, 0xb3, 0xb4, 0xb5, 0xb6, 0xb7,	// 128
  0xb8, 0xb9, 0xba, 0xbb, 0xbc, 0xbd, 0xbe, 0xbf,	// 136
  0xc0, 0xc1, 0xc2, 0xc3, 0xc4, 0xc5, 0xc6, 0xc7,	// 144
  0xc8, 0xc9, 0xca, 0xff, 0xcc, 0xcd, 0xce, 0xcf,	// 152

  0xd0, 0xd1, 0xd2, 0xf1, 0xd4, 0xd5, 0xd6, 0xd7,	// 160
  0xd8, 0xd9, 0xda, 0xdb, 0xdc, 0xdd, 0xde, 0xdf,	// 168
  0xd3, 0xf3, 0xf2, 0xf0, 0xf4, 0xf5, 0xf6, 0xf7,	// 176
  0xf8, 0xf9, 0xfa, 0xfb, 0xfc, 0xfd, 0xfe, 0xcb,	// 184

  0xee, 0xa0, 0xa1, 0xe6, 0xa4, 0xa5, 0xe4, 0xa3,	// 192
  0xe5, 0xa8, 0xa9, 0xaa, 0xab, 0xac, 0xad, 0xae,	// 200
  0xaf, 0xef, 0xe0, 0xe1, 0xe2, 0xe3, 0xa6, 0xa2,	// 208
  0xec, 0xeb, 0xa7, 0xe8, 0xed, 0xe9, 0xe7, 0xea,	// 216

  0x9e, 0x80, 0x81, 0x96, 0x84, 0x85, 0x94, 0x83,	// 224
//  0x95, 0x88, 0x89, 0x8a, 0x8b, 0x8c, 0x8d, 0x8e,	// 232
  0x95, 0x88, 0x89, 0x8a, 0x8b, 0x8c,  'H', 0x8e,	// FIDO soft CR!!
  0x8f, 0x9f, 0x90, 0x91, 0x92, 0x93, 0x86, 0x82,	// 240
  0x9c, 0x9b, 0x87, 0x98, 0x9d, 0x99, 0x97, 0x9a,	// 248
  };


*/
//
//
// ’ ΅«¨ζ  ―¥ΰ¥®¤¨ΰ®Ά¨ β¥―¥ΰμ α®®βΆ¥βαβΆγ¥β RFC 1489
//
//
static uchar
koi8_to_cp866[] =
  {
 0xc4, 0xb3, 0xda, 0xbf, 0xc0, 0xd9, 0xc3, 0xb4,
 0xc2, 0xc1, 0xc5, 0xdf, 0xdc, 0xdb, 0xdd, 0xde,
 0xb0, 0xb1, 0xb2, 0xf4, 0xfe, 0xf9, 0xfb, 0xf7,
 0xf3, 0xf2, 0xff, 0xf5, 0xf8, 0xfd, 0xfa, 0xf6,
 0xcd, 0xba, 0xd5, 0xf1, 0xd6, 0xc9, 0xb8, 0xb7,
 0xbb, 0xd4, 0xd3, 0xc8, 0xbe, 0xbd, 0xbc, 0xc6,
 0xc7, 0xcc, 0xb5, 0xf0, 0xb6, 0xb9, 0xd1, 0xd2,
 0xcb, 0xcf, 0xd0, 0xca, 0xd8, 0xd7, 0xce, 0xfc,
 0xee, 0xa0, 0xa1, 0xe6, 0xa4, 0xa5, 0xe4, 0xa3,
 0xe5, 0xa8, 0xa9, 0xaa, 0xab, 0xac, 0xad, 0xae,
 0xaf, 0xef, 0xe0, 0xe1, 0xe2, 0xe3, 0xa6, 0xa2,
 0xec, 0xeb, 0xa7, 0xe8, 0xed, 0xe9, 0xe7, 0xea,
 0x9e, 0x80, 0x81, 0x96, 0x84, 0x85, 0x94, 0x83,
 0x95, 0x88, 0x89, 0x8a, 0x8b, 0x8c, /*0x8d*/ 'H', 0x8e,
 0x8f, 0x9f, 0x90, 0x91, 0x92, 0x93, 0x86, 0x82,
 0x9c, 0x9b, 0x87, 0x98, 0x9d, 0x99, 0x97, 0x9a
};

static uchar
cp866_to_koi8[] =
{
 0xe1, 0xe2, 0xf7, 0xe7, 0xe4, 0xe5, 0xf6, 0xfa,
 0xe9, 0xea, 0xeb, 0xec, 0xed, 0xee, 0xef, 0xf0,
 0xf2, 0xf3, 0xf4, 0xf5, 0xe6, 0xe8, 0xe3, 0xfe,
 0xfb, 0xfd, 0xff, 0xf9, 0xf8, 0xfc, 0xe0, 0xf1,
 0xc1, 0xc2, 0xd7, 0xc7, 0xc4, 0xc5, 0xd6, 0xda,
 0xc9, 0xca, 0xcb, 0xcc, 0xcd, 0xce, 0xcf, 0xd0,
 0x90, 0x91, 0x92, 0x81, 0x87, 0xb2, 0xb4, 0xa7,
 0xa6, 0xb5, 0xa1, 0xa8, 0xae, 0xad, 0xac, 0x83,
 0x84, 0x89, 0x88, 0x86, 0x80, 0x8a, 0xaf, 0xb0,
 0xab, 0xa5, 0xbb, 0xb8, 0xb1, 0xa0, 0xbe, 0xb9,
 0xba, 0xb6, 0xb7, 0xaa, 0xa9, 0xa2, 0xa4, 0xbd,
// 0xbc, 0x85, 0x82, 0x8d, 0x8c, 0x8e, 0x8f, 0x8b,
 0xbc, 0x85, 0x82,  'H', 0x8c, 0x8e, 0x8f, 0x8b,
 0xd2, 0xd3, 0xd4, 0xd5, 0xc6, 0xc8, 0xc3, 0xde,
 0xdb, 0xdd, 0xdf, 0xd9, 0xd8, 0xdc, 0xc0, 0xd1,
 0xb3, 0xa3, 0x99, 0x98, 0x93, 0x9b, 0x9f, 0x97,
 0x9c, 0x95, 0x9e, 0x96, 0xbf, 0x9d, 0x94, 0x9a
};


// From:  Leonid A. Broukhis <leo@@s514.ipmce.su>

static uchar
leo_to_cp866[] =
  {
  '°', '±', '²', '³', '΄', 'µ', '¶', '·',	// 128
  'Έ', 'Ή', 'Ί', '»', 'Ό', '½', 'Ύ', 'Ώ',	// 136
  'ΐ', 'Α', 'Β', 'Γ', 'Δ', 'Ε', 'Ζ', 'Η',	// 144
  'Θ', 'Ι', 'Κ', '?', 'Μ', 'Ν', 'Ξ', 'Ο',	// 152

  'Π', 'Ρ', '', 'ς', 'Τ', 'Υ', 'Φ', 'Χ',	// 160
  'Ψ', 'Ω', 'Ϊ', 'Ϋ', 'ά', 'έ', 'ή', 'ί',	// 168
  'Σ', 'σ', 'ς', 'ρ', 'τ', 'υ', 'φ', 'χ',	// 176
  'ψ', 'ω', 'ϊ', 'ϋ', 'ό', 'ύ', 'ώ', 'Λ',	// 184

  0xee, 0xa0, 0xa1, 0xe6, 0xa4, 0xa5, 0xe4, 0xa3,	// 192
  0xe5, 0xa8, 0xa9, 0xaa, 0xab, 0xac, 0xad, 0xae,	// 200
  0xaf, 0xef, 0xe0, 0xe1, 0xe2, 0xe3, 0xa6, 0xa2,	// 208
  0xec, 0xeb, 0xa7, 0xe8, 0xed, 0xe9, 0xe7, 0xea,	// 216

  0x9e, 0x80, 0x81, 0x96, 0x84, 0x85, 0x94, 0x83,	// 224
//  0x95, 0x88, 0x89, 0x8a, 0x8b, 0x8c, 0x8d, 0x8e,	// 232
  0x95, 0x88, 0x89, 0x8a, 0x8b, 0x8c,  'H', 0x8e,	// FIDO soft CR!!
  0x8f, 0x9f, 0x90, 0x91, 0x92, 0x93, 0x86, 0x82,	// 240
  0x9c, 0x9b, 0x87, 0x98, 0x9d, 0x99, 0x97, 0x9a,	// 248
  };



// Dummy table to replace russian ''

static uchar
cp866_to_cp866[] =
  {
  0x80, 0x81, 0x82, 0x83, 0x84, 0x85, 0x86, 0x87,
  0x88, 0x89, 0x8A, 0x8B, 0x8C, 'H',  0x8E, 0x8F,

  0x90, 0x91, 0x92, 0x93, 0x94, 0x95, 0x96, 0x97,
  0x98, 0x99, 0x9A, 0x9B, 0x9C, 0x9D, 0x9E, 0x9F,

  0xA0, 0xA1, 0xA2, 0xA3, 0xA4, 0xA5, 0xA6, 0xA7,
  0xA8, 0xA9, 0xAA, 0xAB, 0xAC, 0xAD, 0xAE, 0xAF,

  0xB0, 0xB1, 0xB2, 0xB3, 0xB4, 0xB5, 0xB6, 0xB7,
  0xB8, 0xB9, 0xBA, 0xBB, 0xBC, 0xBD, 0xBE, 0xBF,

  0xC0, 0xC1, 0xC2, 0xC3, 0xC4, 0xC5, 0xC6, 0xC7,
  0xC8, 0xC9, 0xCA, 0xCB, 0xCC, 0xCD, 0xCE, 0xCF,

  0xD0, 0xD1, 0xD2, 0xD3, 0xD4, 0xD5, 0xD6, 0xD7,
  0xD8, 0xD9, 0xDA, 0xDB, 0xDC, 0xDD, 0xDE, 0xDF,
a126 2
  0xE0, 0xE1, 0xE2, 0xE3, 0xE4, 0xE5, 0xE6, 0xE7,
  0xE8, 0xE9, 0xEA, 0xEB, 0xEC, 0xED, 0xEE, 0xEF,
a127 2
  0xF0, 0xF1, 0xF2, 0xF3, 0xF4, 0xF5, 0xF6, 0xF7,
  0xF8, 0xF9, 0xFA, 0xFB, 0xFC, 0xFD, 0xFE, 0xFF
a128 1
  };
@
